{"ast":null,"code":"import { ofType } from 'redux-observable';\nimport { map, switchMap, mapTo } from 'rxjs/operators';\nimport { TYPES as DashboardTypes } from '../Redux/DashboardRedux';\nimport { TYPES as ErrorTypes } from '../Redux/ErrorRedux';\nimport firebase from '../Firebase/index';\nexport const uploadErrorEpic = action$ => action$.pipe(ofType(DashboardTypes.UPLOAD_ERROR), mapTo({\n  type: ErrorTypes.SET_ERROR,\n  payload: 'Error saving to our records, try again...'\n}));\nexport const saveToDatabase = (action$, state$) => action$.pipe(ofType(DashboardTypes.UPLOAD_SUCCESS), switchMap(action => {\n  const _action$payload = action.payload,\n        filename = _action$payload.filename,\n        id = _action$payload.id,\n        timestamp = _action$payload.timestamp,\n        downloadUrl = _action$payload.downloadUrl;\n  const userId = state$.value.UserReducers.userReducer.id; // get timesheet id, user id, timestamp\n\n  const userTimesheetRef = firebase.database().ref(`/user-timesheets/${userId}/${id}/`);\n  userTimesheetRef.set({\n    filename,\n    id,\n    userId,\n    timestamp,\n    downloadUrl\n  });\n}));\nexport const uploadCompleteEpic = action$ => action$.pipe(ofType(DashboardTypes.UPLOAD_SUCCESS, DashboardTypes.UPLOAD_ERROR), mapTo({\n  type: DashboardTypes.TIMESHEET_UPLOAD_STOP\n}));\nexport const showUploadSuccessEpic = action$ => action$.pipe(ofType(DashboardTypes.UPLOAD_SUCCESS), mapTo({\n  type: ErrorTypes.SET_ERROR,\n  payload: 'Successfully uploaded your timesheet'\n}));\nexport const setTimesheetFileError = action$ => action$.pipe(ofType(DashboardTypes.SET_TIMESHEET_FILE_ERROR), map(action => ({\n  type: ErrorTypes.SET_ERROR,\n  payload: action.payload\n})));\nexport default null;","map":{"version":3,"sources":["/Users/joshkardos/Desktop/JTKStaffing/src/Epics/DashboardEpics.js"],"names":["ofType","map","switchMap","mapTo","TYPES","DashboardTypes","ErrorTypes","firebase","uploadErrorEpic","action$","pipe","UPLOAD_ERROR","type","SET_ERROR","payload","saveToDatabase","state$","UPLOAD_SUCCESS","action","filename","id","timestamp","downloadUrl","userId","value","UserReducers","userReducer","userTimesheetRef","database","ref","set","uploadCompleteEpic","TIMESHEET_UPLOAD_STOP","showUploadSuccessEpic","setTimesheetFileError","SET_TIMESHEET_FILE_ERROR"],"mappings":"AAAA,SAASA,MAAT,QAAuB,kBAAvB;AACA,SAASC,GAAT,EAAcC,SAAd,EAAyBC,KAAzB,QAAsC,gBAAtC;AACA,SAASC,KAAK,IAAIC,cAAlB,QAAwC,yBAAxC;AACA,SAASD,KAAK,IAAIE,UAAlB,QAAoC,qBAApC;AACA,OAAOC,QAAP,MAAqB,mBAArB;AAEA,OAAO,MAAMC,eAAe,GAAIC,OAAD,IAAaA,OAAO,CAACC,IAAR,CAC1CV,MAAM,CAACK,cAAc,CAACM,YAAhB,CADoC,EAE1CR,KAAK,CAAC;AAAES,EAAAA,IAAI,EAAEN,UAAU,CAACO,SAAnB;AAA8BC,EAAAA,OAAO,EAAE;AAAvC,CAAD,CAFqC,CAArC;AAKP,OAAO,MAAMC,cAAc,GAAG,CAACN,OAAD,EAAUO,MAAV,KAAqBP,OAAO,CAACC,IAAR,CACjDV,MAAM,CAACK,cAAc,CAACY,cAAhB,CAD2C,EAEjDf,SAAS,CAACgB,MAAM,IAAI;AAAA,0BAC+BA,MAAM,CAACJ,OADtC;AAAA,QACVK,QADU,mBACVA,QADU;AAAA,QACAC,EADA,mBACAA,EADA;AAAA,QACIC,SADJ,mBACIA,SADJ;AAAA,QACeC,WADf,mBACeA,WADf;AAElB,QAAMC,MAAM,GAAGP,MAAM,CAACQ,KAAP,CAAaC,YAAb,CAA0BC,WAA1B,CAAsCN,EAArD,CAFkB,CAGlB;;AACA,QAAMO,gBAAgB,GAAGpB,QAAQ,CAACqB,QAAT,GAAoBC,GAApB,CAAyB,oBAAmBN,MAAO,IAAGH,EAAG,GAAzD,CAAzB;AACAO,EAAAA,gBAAgB,CAACG,GAAjB,CAAqB;AACnBX,IAAAA,QADmB;AAEnBC,IAAAA,EAFmB;AAGnBG,IAAAA,MAHmB;AAInBF,IAAAA,SAJmB;AAKnBC,IAAAA;AALmB,GAArB;AAOD,CAZQ,CAFwC,CAA5C;AAiBP,OAAO,MAAMS,kBAAkB,GAAItB,OAAD,IAAaA,OAAO,CAACC,IAAR,CAC7CV,MAAM,CAACK,cAAc,CAACY,cAAhB,EAAgCZ,cAAc,CAACM,YAA/C,CADuC,EAE7CR,KAAK,CAAC;AAAES,EAAAA,IAAI,EAAEP,cAAc,CAAC2B;AAAvB,CAAD,CAFwC,CAAxC;AAKP,OAAO,MAAMC,qBAAqB,GAAIxB,OAAD,IAAaA,OAAO,CAACC,IAAR,CAChDV,MAAM,CAACK,cAAc,CAACY,cAAhB,CAD0C,EAEhDd,KAAK,CAAC;AAAES,EAAAA,IAAI,EAAEN,UAAU,CAACO,SAAnB;AAA8BC,EAAAA,OAAO,EAAE;AAAvC,CAAD,CAF2C,CAA3C;AAKP,OAAO,MAAMoB,qBAAqB,GAAIzB,OAAD,IAAaA,OAAO,CAACC,IAAR,CAChDV,MAAM,CAACK,cAAc,CAAC8B,wBAAhB,CAD0C,EAEhDlC,GAAG,CAAEiB,MAAD,KAAa;AAAEN,EAAAA,IAAI,EAAEN,UAAU,CAACO,SAAnB;AAA8BC,EAAAA,OAAO,EAAEI,MAAM,CAACJ;AAA9C,CAAb,CAAD,CAF6C,CAA3C;AAKP,eAAe,IAAf","sourcesContent":["import { ofType } from 'redux-observable'\nimport { map, switchMap, mapTo } from 'rxjs/operators';\nimport { TYPES as DashboardTypes } from '../Redux/DashboardRedux'\nimport { TYPES as ErrorTypes } from '../Redux/ErrorRedux'\nimport firebase from '../Firebase/index'\n\nexport const uploadErrorEpic = (action$) => action$.pipe(\n  ofType(DashboardTypes.UPLOAD_ERROR),\n  mapTo({ type: ErrorTypes.SET_ERROR, payload: 'Error saving to our records, try again...' })\n)\n\nexport const saveToDatabase = (action$, state$) => action$.pipe(\n  ofType(DashboardTypes.UPLOAD_SUCCESS),\n  switchMap(action => {\n    const { filename, id, timestamp, downloadUrl } = action.payload\n    const userId = state$.value.UserReducers.userReducer.id\n    // get timesheet id, user id, timestamp\n    const userTimesheetRef = firebase.database().ref(`/user-timesheets/${userId}/${id}/`)\n    userTimesheetRef.set({\n      filename,\n      id,\n      userId,\n      timestamp,\n      downloadUrl\n    })\n  })\n)\n\nexport const uploadCompleteEpic = (action$) => action$.pipe(\n  ofType(DashboardTypes.UPLOAD_SUCCESS, DashboardTypes.UPLOAD_ERROR),\n  mapTo({ type: DashboardTypes.TIMESHEET_UPLOAD_STOP })\n)\n\nexport const showUploadSuccessEpic = (action$) => action$.pipe(\n  ofType(DashboardTypes.UPLOAD_SUCCESS),\n  mapTo({ type: ErrorTypes.SET_ERROR, payload: 'Successfully uploaded your timesheet' })\n)\n\nexport const setTimesheetFileError = (action$) => action$.pipe(\n  ofType(DashboardTypes.SET_TIMESHEET_FILE_ERROR),\n  map((action) => ({ type: ErrorTypes.SET_ERROR, payload: action.payload }))\n)\n\nexport default null\n"]},"metadata":{},"sourceType":"module"}