{"ast":null,"code":"import _toConsumableArray from\"/Users/joshkardos/Desktop/JTKStaffing/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import{ofType}from'redux-observable';import{switchMap,mapTo,map,filter}from'rxjs/operators';import{TYPES as UserTypes,userLoggedIn}from'../Redux/UserRedux';import{TYPES as ErrorTypes}from'../Redux/ErrorRedux';import{TYPES as LayoutTypes,LAYOUTS}from'../Redux/LayoutRedux';import firebase from'../Firebase/index';export var loginEpic=function loginEpic(action$){return action$.pipe(ofType(UserTypes.LOGIN),switchMap(function(action){var email=action.email,password=action.password;return firebase.auth().signInWithEmailAndPassword(email,password).then(function(value){var uid=value.user.uid;return{type:UserTypes.FETCH_USER_DATA,payload:uid};}).catch(function(error){// error\nvar errorMessage=error.message;return{type:ErrorTypes.SET_ERROR,payload:errorMessage};});}));};export var signUpWorkerEpic=function signUpWorkerEpic(action$,state$){return action$.pipe(ofType(UserTypes.SIGN_UP_WORKER),switchMap(function(action){var name=action.name,email=action.email,password=action.password;return firebase.auth().createUserWithEmailAndPassword(email,password).then(function(value){// success\nvar uid=value.user.uid;var usersRef=firebase.database().ref(\"/users/\".concat(uid));usersRef.set({name:name,email:email,company:state$.value.UserReducers.userReducer.company,uid:uid});var userAdminRef=firebase.database().ref(\"/admin-workers/\".concat(state$.value.UserReducers.userReducer.id,\"/\").concat(uid));userAdminRef.set(1);return window.location.reload();// new user will be logged in\n}).catch(function(error){// error\nvar errorMessage=error.message;return{type:ErrorTypes.SET_ERROR,payload:errorMessage};});}));};export var signUpAdminEpic=function signUpAdminEpic(action$){return action$.pipe(ofType(UserTypes.SIGN_UP_ADMIN),switchMap(function(action){var name=action.name,email=action.email,password=action.password,company=action.company;return firebase.auth().createUserWithEmailAndPassword(email,password).then(function(value){// success\nvar uid=value.user.uid;var ref=firebase.database().ref(\"/users/\".concat(uid));ref.set({name:name,email:email,company:company,uid:uid,admin:true});return{type:UserTypes.SET_USER_DATA,payload:{id:uid,name:name,email:email,company:company,admin:true}};}).catch(function(error){// error\nvar errorMessage=error.message;return{type:ErrorTypes.SET_ERROR,payload:errorMessage};});}));};export var setSignUpErrorEpic=function setSignUpErrorEpic(action$){return action$.pipe(ofType(UserTypes.SET_SIGN_UP_ERROR),map(function(action){return{type:ErrorTypes.SET_ERROR,payload:action.payload};}));};export var startSignUpLoadingEpic=function startSignUpLoadingEpic(action$){return action$.pipe(ofType(UserTypes.SIGN_UP_ADMIN,UserTypes.SIGN_UP_WORKER),mapTo({type:UserTypes.START_SIGN_UP_LOADING}));};export var stopSignUpLoadingEpic=function stopSignUpLoadingEpic(action$,state$){return action$.pipe(ofType(ErrorTypes.SET_ERROR,UserTypes.SET_USER_DATA),filter(function(){return state$.value.UserReducers.userReducer.signUpLoading;}),// only stop sign up loading if it has started\nmapTo({type:UserTypes.STOP_SIGN_UP_LOADING}));};export var startLoginLoadingEpic=function startLoginLoadingEpic(action$){return action$.pipe(ofType(UserTypes.LOGIN),mapTo({type:UserTypes.START_LOGIN_LOADING}));};export var stopLoginLoadingEpic=function stopLoginLoadingEpic(action$,state$){return action$.pipe(ofType(ErrorTypes.SET_ERROR,UserTypes.SET_USER_DATA),filter(function(){return state$.value.UserReducers.userReducer.loginLoading;}),// only stop sign up loading if it has started\nmapTo({type:UserTypes.STOP_LOGIN_LOADING}));};export var fetchUserDataEpic=function fetchUserDataEpic(action$,state$){return action$.pipe(ofType(UserTypes.FETCH_USER_DATA),filter(function(){return!userLoggedIn(state$.value.UserReducers.userReducer);}),// only fetch if user is not logged in\nswitchMap(function(action){var userId=action.payload;var employees=[];return firebase.database().ref(\"/users/\".concat(userId)).once('value').then(function(snapshot){var name=snapshot.val()&&snapshot.val().name||'N/A';var email=snapshot.val()&&snapshot.val().email||'N/A';var company=snapshot.val()&&snapshot.val().company||'N/A';var id=snapshot.val()&&snapshot.val().uid||'N/A';var admin=snapshot.val()&&snapshot.val().admin||null;if(admin){// load employees\nreturn firebase.database().ref(\"/admin-workers/\".concat(userId)).once('value').then(function(adminEmployeesSnapshot){return firebase.database().ref('/users').once('value').then(function(allUsersSnapshot){if(!adminEmployeesSnapshot.val())return{type:UserTypes.SET_USER_DATA,payload:{id:id,name:name,email:email,company:company,admin:admin}};// no employee\nObject.keys(allUsersSnapshot.val()).forEach(function(userId){if(Object.keys(adminEmployeesSnapshot.val()).includes(userId)){employees=[].concat(_toConsumableArray(employees),[allUsersSnapshot.val()[\"\".concat(userId)]]);}});return{type:UserTypes.SET_USER_DATA,payload:{id:id,name:name,email:email,company:company,admin:admin,employees:employees}};});});// eslint-disable-next-line no-else-return\n}else{// load timesheets\nreturn firebase.database().ref(\"/user-timesheets/\".concat(userId)).once('value').then(function(userTimesheetsSnapshot){if(!userTimesheetsSnapshot.val())return{type:UserTypes.SET_USER_DATA,payload:{id:id,name:name,email:email,company:company,admin:admin}};var timesheetArr=[];Object.keys(userTimesheetsSnapshot.val()).map(function(key){timesheetArr=[].concat(_toConsumableArray(timesheetArr),[userTimesheetsSnapshot.val()[key]]);// eslint-disable-next-line no-useless-return\nreturn;});return{type:UserTypes.SET_USER_DATA,payload:{id:id,name:name,email:email,company:company,admin:admin,timesheets:timesheetArr.reverse()}};});}});}));};export var homePageAfterLoginOrSignUpEpic=function homePageAfterLoginOrSignUpEpic(action$,state$){return action$.pipe(ofType(UserTypes.SET_USER_DATA),filter(function(){return state$.value.LayoutReducers.layoutReducer.currentLayout===LAYOUTS.LOGIN||state$.value.LayoutReducers.layoutReducer.currentLayout===LAYOUTS.SIGNUP;}),mapTo({type:LayoutTypes.SET_HOME_LAYOUT}));};export var logOutEpic=function logOutEpic(action$){return action$.pipe(ofType(UserTypes.LOG_OUT),switchMap(function(){return firebase.auth().signOut().then(function(){return(// Sign-out successful.\n{type:LayoutTypes.SET_LOGIN_LAYOUT});}).catch(function(error){return{type:ErrorTypes.SET_ERROR,payload:error.message};});}));};export default null;","map":{"version":3,"sources":["/Users/joshkardos/Desktop/JTKStaffing/src/Epics/UserEpics.js"],"names":["ofType","switchMap","mapTo","map","filter","TYPES","UserTypes","userLoggedIn","ErrorTypes","LayoutTypes","LAYOUTS","firebase","loginEpic","action$","pipe","LOGIN","action","email","password","auth","signInWithEmailAndPassword","then","value","uid","user","type","FETCH_USER_DATA","payload","catch","error","errorMessage","message","SET_ERROR","signUpWorkerEpic","state$","SIGN_UP_WORKER","name","createUserWithEmailAndPassword","usersRef","database","ref","set","company","UserReducers","userReducer","userAdminRef","id","window","location","reload","signUpAdminEpic","SIGN_UP_ADMIN","admin","SET_USER_DATA","setSignUpErrorEpic","SET_SIGN_UP_ERROR","startSignUpLoadingEpic","START_SIGN_UP_LOADING","stopSignUpLoadingEpic","signUpLoading","STOP_SIGN_UP_LOADING","startLoginLoadingEpic","START_LOGIN_LOADING","stopLoginLoadingEpic","loginLoading","STOP_LOGIN_LOADING","fetchUserDataEpic","userId","employees","once","snapshot","val","adminEmployeesSnapshot","allUsersSnapshot","Object","keys","forEach","includes","userTimesheetsSnapshot","timesheetArr","key","timesheets","reverse","homePageAfterLoginOrSignUpEpic","LayoutReducers","layoutReducer","currentLayout","SIGNUP","SET_HOME_LAYOUT","logOutEpic","LOG_OUT","signOut","SET_LOGIN_LAYOUT"],"mappings":"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","sourcesContent":["import { ofType } from 'redux-observable'\nimport { switchMap, mapTo, map, filter } from 'rxjs/operators';\nimport { TYPES as UserTypes, userLoggedIn } from '../Redux/UserRedux'\nimport { TYPES as ErrorTypes } from '../Redux/ErrorRedux'\nimport { TYPES as LayoutTypes, LAYOUTS } from '../Redux/LayoutRedux'\nimport firebase from '../Firebase/index'\n\nexport const loginEpic = (action$) => action$.pipe(\n  ofType(UserTypes.LOGIN),\n  switchMap(action => {\n    const { email, password } = action\n    return firebase.auth().signInWithEmailAndPassword(email, password).then((value) => {\n      const { uid } = value.user\n      return { type: UserTypes.FETCH_USER_DATA, payload: uid }\n    }).catch((error) => {\n      // error\n      const errorMessage = error.message\n      return { type: ErrorTypes.SET_ERROR, payload: errorMessage }\n    })\n  })\n)\n\nexport const signUpWorkerEpic = (action$, state$) => action$.pipe(\n  ofType(UserTypes.SIGN_UP_WORKER),\n  switchMap(action => {\n    const { name, email, password } = action\n    return firebase.auth().createUserWithEmailAndPassword(email, password).then((value) => {\n      // success\n      const { uid } = value.user\n      const usersRef = firebase.database().ref(`/users/${uid}`)\n      usersRef.set({\n        name,\n        email,\n        company: state$.value.UserReducers.userReducer.company,\n        uid\n      })\n      const userAdminRef = firebase.database().ref(`/admin-workers/${state$.value.UserReducers.userReducer.id}/${uid}`)\n      userAdminRef.set(1)\n      return window.location.reload() // new user will be logged in\n    }).catch((error) => {\n      // error\n      const errorMessage = error.message\n      return { type: ErrorTypes.SET_ERROR, payload: errorMessage }\n    })\n  })\n)\n\nexport const signUpAdminEpic = (action$) => action$.pipe(\n  ofType(UserTypes.SIGN_UP_ADMIN),\n  switchMap(action => {\n    const { name, email, password, company } = action\n    return firebase.auth().createUserWithEmailAndPassword(email, password).then((value) => {\n      // success\n      const { uid } = value.user\n      const ref = firebase.database().ref(`/users/${uid}`)\n      ref.set({\n        name,\n        email,\n        company,\n        uid,\n        admin: true\n      })\n      return { type: UserTypes.SET_USER_DATA, payload: { id: uid, name, email, company, admin: true } }\n    }).catch((error) => {\n      // error\n      const errorMessage = error.message\n      return { type: ErrorTypes.SET_ERROR, payload: errorMessage }\n    })\n  })\n)\n\nexport const setSignUpErrorEpic = (action$) => action$.pipe(\n  ofType(UserTypes.SET_SIGN_UP_ERROR),\n  map((action) => ({ type: ErrorTypes.SET_ERROR, payload: action.payload }))\n)\n\nexport const startSignUpLoadingEpic = (action$) => action$.pipe(\n  ofType(UserTypes.SIGN_UP_ADMIN, UserTypes.SIGN_UP_WORKER),\n  mapTo({ type: UserTypes.START_SIGN_UP_LOADING })\n)\n\nexport const stopSignUpLoadingEpic = (action$, state$) => action$.pipe(\n  ofType(ErrorTypes.SET_ERROR, UserTypes.SET_USER_DATA),\n  filter(() => state$.value.UserReducers.userReducer.signUpLoading), // only stop sign up loading if it has started\n  mapTo({ type: UserTypes.STOP_SIGN_UP_LOADING })\n)\n\nexport const startLoginLoadingEpic = (action$) => action$.pipe(\n  ofType(UserTypes.LOGIN),\n  mapTo({ type: UserTypes.START_LOGIN_LOADING })\n)\n\nexport const stopLoginLoadingEpic = (action$, state$) => action$.pipe(\n  ofType(ErrorTypes.SET_ERROR, UserTypes.SET_USER_DATA),\n  filter(() => state$.value.UserReducers.userReducer.loginLoading), // only stop sign up loading if it has started\n  mapTo({ type: UserTypes.STOP_LOGIN_LOADING })\n)\n\nexport const fetchUserDataEpic = (action$, state$) => action$.pipe(\n  ofType(UserTypes.FETCH_USER_DATA),\n  filter(() => !userLoggedIn(state$.value.UserReducers.userReducer)), // only fetch if user is not logged in\n  switchMap(action => {\n    const userId = action.payload\n    let employees = []\n    return firebase.database().ref(`/users/${userId}`).once('value').then((snapshot) => {\n      const name = (snapshot.val() && snapshot.val().name) || 'N/A'\n      const email = (snapshot.val() && snapshot.val().email) || 'N/A'\n      const company = (snapshot.val() && snapshot.val().company) || 'N/A'\n      const id = (snapshot.val() && snapshot.val().uid) || 'N/A'\n      const admin = (snapshot.val() && snapshot.val().admin) || null\n\n      if (admin) { // load employees\n        return firebase.database().ref(`/admin-workers/${userId}`).once('value').then((adminEmployeesSnapshot) => firebase.database().ref('/users').once('value').then((allUsersSnapshot) => {\n          if (!adminEmployeesSnapshot.val()) return { type: UserTypes.SET_USER_DATA, payload: { id, name, email, company, admin } } // no employee\n          Object.keys(allUsersSnapshot.val()).forEach(userId => {\n            if (Object.keys(adminEmployeesSnapshot.val()).includes(userId)) {\n              employees = [...employees, allUsersSnapshot.val()[`${userId}`]]\n            }\n          })\n          return { type: UserTypes.SET_USER_DATA, payload: { id, name, email, company, admin, employees } }\n        }))\n      // eslint-disable-next-line no-else-return\n      } else { // load timesheets\n        return firebase.database().ref(`/user-timesheets/${userId}`).once('value').then(userTimesheetsSnapshot => {\n          if (!userTimesheetsSnapshot.val()) return { type: UserTypes.SET_USER_DATA, payload: { id, name, email, company, admin } }\n          let timesheetArr = []\n          Object.keys(userTimesheetsSnapshot.val()).map(key => {\n            timesheetArr = [...timesheetArr, userTimesheetsSnapshot.val()[key]]\n            // eslint-disable-next-line no-useless-return\n            return\n          })\n          return { type: UserTypes.SET_USER_DATA, payload: { id, name, email, company, admin, timesheets: timesheetArr.reverse() } }\n        })\n      }\n    })\n  })\n)\n\nexport const homePageAfterLoginOrSignUpEpic = (action$, state$) => action$.pipe(\n  ofType(UserTypes.SET_USER_DATA),\n  filter(() => state$.value.LayoutReducers.layoutReducer.currentLayout === LAYOUTS.LOGIN || state$.value.LayoutReducers.layoutReducer.currentLayout === LAYOUTS.SIGNUP),\n  mapTo({ type: LayoutTypes.SET_HOME_LAYOUT })\n)\n\n\nexport const logOutEpic = (action$) => action$.pipe(\n  ofType(UserTypes.LOG_OUT),\n  switchMap(() => firebase.auth().signOut().then(() => (\n    // Sign-out successful.\n    { type: LayoutTypes.SET_LOGIN_LAYOUT }\n  )).catch(error => (\n    { type: ErrorTypes.SET_ERROR, payload: error.message }\n  )))\n)\n\nexport default null\n"]},"metadata":{},"sourceType":"module"}